(window.webpackJsonp=window.webpackJsonp||[]).push([[6],{167:function(t,s,a){"use strict";a.r(s);var n=a(0),e=Object(n.a)({},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"content"},[t._m(0),t._v(" "),t._m(1),t._v(" "),t._m(2),t._v(" "),a("p",[t._v("Midway 自 2013 年开始，基本保持着一年一个大版本的迭代速度进行更新，从 express 到 koa1/2，从未缺席。")]),t._v(" "),t._m(3),t._v(" "),a("p",[t._v("在 2017 年，我们将集团内部的 Midway 5.3 升级到了基于 Koa2 的模型，全面支持了 async/await 的编码风格。\n''\n同年年中，我们开始计划将监控和数据采集能力进行抽象剥离，形成了全新 Pandora.js 工具，不仅仅服务于 Midway，也服务于全网，乃至外部所有的 Node.js 应用。")]),t._v(" "),a("p",[t._v("2018 年，MidwayJs 团队将基于 Typescript，将 Midway6 在新的语言层面进行升级，让用户在开发体验上更近一步，对外部则是从第一个版本开始。")]),t._v(" "),a("p",[t._v("为什么选择 Typescript ? 相信"),a("a",{attrs:{href:"https://juejin.im/post/59c46bc86fb9a00a4636f939",target:"_blank",rel:"noopener noreferrer"}},[t._v(" 这篇文章"),a("OutboundLink")],1),t._v(" 会给你一些答案。")]),t._v(" "),t._m(4),t._v(" "),a("p",[t._v("Midway (中途岛) 品牌是淘宝技术部（前淘宝UED）前端部门研发的一款基于 Node.js 的全栈开发解决方案。它将搭配团队的其他产品，pandora 和 sandbox，将 Node.js 的开发体验朝着全新的场景发展，让用户在开发过程中享受到前所未有的愉悦感。")]),t._v(" "),t._m(5),t._v(" "),t._m(6),t._v(" "),a("p",[t._v("访问 "),a("a",{attrs:{href:"https://lark.alipay.com/alinode/handbook/env",target:"_blank",rel:"noopener noreferrer"}},[t._v("Node.js 开发环境搭建"),a("OutboundLink")],1)]),t._v(" "),t._m(7),t._v(" "),a("p",[t._v("使用 "),a("a",{attrs:{href:"https://www.npmjs.com/package/midway-init",target:"_blank",rel:"noopener noreferrer"}},[t._v("midway-init"),a("OutboundLink")],1),t._v(" 工具自动创建 midway 应用的目录结构:")]),t._v(" "),t._m(8),a("p",[t._v("目前只有一个 ts 的脚手架，可以直接使用。")]),t._v(" "),t._m(9),t._v(" "),t._m(10),t._m(11),t._v(" "),a("p",[t._v("midway 的目录和 eggjs 目录非常接近，但也有所区别，不同的地方在于：")]),t._v(" "),t._m(12),t._v(" "),t._m(13),a("p",[t._v("如上，由框架约定的目录：")]),t._v(" "),a("ul",[a("li",[a("code",[t._v("app/router.ts")]),t._v(" 可选，用于配置 URL 路由规则，具体参见 "),a("a",{attrs:{href:"https://eggjs.org/zh-cn/basics/router.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("Router"),a("OutboundLink")],1),t._v("。")]),t._v(" "),t._m(14),t._v(" "),a("li",[a("code",[t._v("app/middleware/**")]),t._v(" 可选，用于编写中间件，具体参见 "),a("a",{attrs:{href:"https://eggjs.org/zh-cn/basics/middleware.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("Middleware"),a("OutboundLink")],1),t._v("。")]),t._v(" "),a("li",[a("code",[t._v("app/extend/**")]),t._v(" 可选，用于框架的扩展，具体参见"),a("a",{attrs:{href:"https://eggjs.org/zh-cn/basics/extend.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("框架扩展"),a("OutboundLink")],1),t._v("。")]),t._v(" "),a("li",[a("code",[t._v("config/config.{env}.ts")]),t._v(" 用于编写配置文件，具体参见"),a("a",{attrs:{href:"https://eggjs.org/zh-cn/basics/config.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("配置"),a("OutboundLink")],1),t._v("。")]),t._v(" "),a("li",[a("code",[t._v("config/plugin.ts")]),t._v(" 用于配置需要加载的插件，具体参见"),a("a",{attrs:{href:"https://eggjs.org/zh-cn/basics/plugin.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("插件"),a("OutboundLink")],1),t._v("。")]),t._v(" "),a("li",[a("code",[t._v("test/**")]),t._v(" 用于单元测试，具体参见"),a("a",{attrs:{href:"https://eggjs.org/zh-cn/core/unittest.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("单元测试"),a("OutboundLink")],1),t._v("。")]),t._v(" "),a("li",[a("code",[t._v("app.ts")]),t._v(" 和 "),a("code",[t._v("agent.ts")]),t._v(" 用于自定义启动时的初始化工作，可选，具体参见"),a("a",{attrs:{href:"https://eggjs.org/zh-cn/basics/app-start.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("启动自定义"),a("OutboundLink")],1),t._v("。关于"),a("code",[t._v("agent.js")]),t._v("的作用参见"),a("a",{attrs:{href:"https://eggjs.org/zh-cn/core/cluster-and-ipc.html#agent-%E6%9C%BA%E5%88%B6",target:"_blank",rel:"noopener noreferrer"}},[t._v("Agent机制"),a("OutboundLink")],1),t._v("。")])]),t._v(" "),a("p",[t._v("由内置插件约定的目录：")]),t._v(" "),a("ul",[a("li",[a("code",[t._v("app/public/**")]),t._v(" 用于放置静态资源，可选，具体参见内置插件 "),a("a",{attrs:{href:"https://github.com/eggjs/egg-static",target:"_blank",rel:"noopener noreferrer"}},[t._v("egg-static"),a("OutboundLink")],1),t._v("。")]),t._v(" "),a("li",[a("code",[t._v("app/schedule/**")]),t._v(" 用于定时任务，可选，具体参见"),a("a",{attrs:{href:"https://eggjs.org/zh-cn/basics/schedule.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("定时任务"),a("OutboundLink")],1),t._v("。")]),t._v(" "),a("li",[a("code",[t._v("app/view/**")]),t._v(" 用于放置模板文件，可选，由模板插件约定，具体参见"),a("a",{attrs:{href:"https://eggjs.org/zh-cn/core/view.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("模板渲染"),a("OutboundLink")],1),t._v("。")]),t._v(" "),a("li",[a("code",[t._v("app/model/**")]),t._v(" 用于放置领域模型，可选，由领域类相关插件约定，如 "),a("a",{attrs:{href:"https://github.com/eggjs/egg-sequelize",target:"_blank",rel:"noopener noreferrer"}},[t._v("egg-sequelize"),a("OutboundLink")],1),t._v("。")])]),t._v(" "),t._m(15),t._v(" "),t._m(16),t._v(" "),a("p",[t._v("IoC("),a("a",{attrs:{href:"https://en.wikipedia.org/wiki/Inversion_of_control",target:"_blank",rel:"noopener noreferrer"}},[t._v("Inversion of control"),a("OutboundLink")],1),t._v(") 控制反转，是 Java Spring 中非常重要的思想和核心，有不少人是第一次听说，也不禁会有许多疑问。")]),t._v(" "),t._m(17),t._v(" "),a("p",[t._v("软件中的对象就像齿轮一样，协同工作，但是互相耦合，一个零件不能正常工作，整个系统就崩溃了。这是一个强耦合的系统。")]),t._v(" "),a("p",[t._v("现在，伴随着工业级应用的规模越来越庞大，对象之间的依赖关系也越来越复杂，经常会出现对象之间的多重依赖性关系，因此，架构师和设计师对于系统的分析和设计，将面临更大的挑战。")]),t._v(" "),t._m(18),a("p",[t._v('这里的 A 被 B 和 C 所依赖，而且在构造器需要进行实例化操作，这样的依赖关系在测试中会非常麻烦。这个依赖，一般被叫做 "耦合"，而耦合度过高的系统，必然会出现牵一发而动全身的情形。')]),t._v(" "),a("p",[t._v("为了解决对象间耦合度过高的问题，软件专家 Michael Mattson 提出了 IoC 理论，用来实现对象之间的“解耦”。")]),t._v(" "),a("p",[t._v("控制反转（Inversion of Control）是一种是面向对象编程中的一种设计原则，用来减低计算机代码之间的耦合度。")]),t._v(" "),t._m(19),t._m(20),t._v(" "),t._m(21),t._v(" "),t._m(22),t._v(" "),t._m(23),t._v(" "),t._m(24),t._v(" "),a("p",[t._v("midway 使用 "),a("a",{attrs:{href:"https://www.npmjs.com/package/injection",target:"_blank",rel:"noopener noreferrer"}},[t._v("injection"),a("OutboundLink")],1),t._v(" 来作为 IoC 容器的基础，此外，midway 还扩展了请求作用域。")]),t._v(" "),t._m(25),t._v(" "),t._m(26),t._v(" "),t._m(27),a("p",[t._v("我们可以看到业务代码的样子和以往有着一些不同。")]),t._v(" "),t._m(28),t._v(" "),t._m(29),t._v(" "),t._m(30),t._v(" "),t._m(31),t._v(" "),t._m(32),t._v(" "),t._m(33),t._v(" "),t._m(34),t._v(" "),t._m(35),t._v(" "),t._m(36),t._v(" "),t._m(37),t._v(" "),t._m(38),t._v(" "),t._m(39),t._m(40),t._v(" "),a("p",[t._v("而在某些场景下，用户希望注入不同的实例，这个时候可以对默认生成的 id 进行修改。")]),t._v(" "),t._m(41),t._m(42),t._v(" "),t._m(43),t._v(" "),a("p",[t._v("midway 使用 koa-router 作为路由的承载着，同时在 ts 的语法上做了一些简化，我们将路由和控制器放在了一起，使用装饰器来标注路由。")]),t._v(" "),t._m(44),t._v(" "),t._m(45),t._v(" "),t._m(46),t._m(47),t._v(" "),t._m(48),t._v(" "),t._m(49),t._v(" "),a("p",[t._v("midway 针对 web 请求，提供了和 koa-router 对应的方法装饰器，列表如下。")]),t._v(" "),t._m(50),t._v(" "),a("p",[t._v("这几个装饰器用于修饰不同的异步方法，同时对应到了 koa-router 的相应的方法。和原有提供的控制器一样，每个控制器都为异步方法，参数为 koa 上下文。")]),t._v(" "),t._m(51),t._m(52),t._v(" "),t._m(53),t._v(" "),t._m(54),t._v(" "),t._m(55),t._v(" "),t._m(56),a("p",[t._v("假如我们希望这个控制器可以被外部的路由使用。")]),t._v(" "),t._m(57),t._m(58),t._v(" "),t._m(59),t._v(" "),t._m(60),t._v(" "),t._m(61),t._v(" "),t._m(62),t._m(63),t._v(" "),t._m(64),t._v(" "),t._m(65),t._v(" "),t._m(66),t._v(" "),t._m(67),t._v(" "),t._m(68),t._v(" "),t._m(69),a("p",[t._v("在 Midway 中获取容器有几个方法。")]),t._v(" "),t._m(70),t._m(71),t._v(" "),t._m(72),a("p",[t._v("这些逻辑在 Midway 内部已经完成，绑定都会自动完成。")]),t._v(" "),t._m(73),t._v(" "),a("p",[t._v("在 midway 体系中，有三种作用域。")]),t._v(" "),t._m(74),t._v(" "),t._m(75),t._v(" "),t._m(76),t._v(" "),t._m(77),a("p",{staticClass:"warning"},[t._v("\n  插件，在 midway 中为单例，不可配置。\n")]),t._v(" "),t._m(78),t._v(" "),a("p",[t._v("midway 默认使用 "),a("a",{attrs:{href:"http://web.npm.alibaba-inc.com/package/injection",target:"_blank",rel:"noopener noreferrer"}},[t._v("injection"),a("OutboundLink")],1),t._v(" 这个包来做依赖注入，虽然 "),a("code",[t._v("@inject")]),t._v(" 装饰器能满足大多数业务的需求，但是对于框架来说，还有需要需要扩展和使用的地方，比如插件，配置等等。")]),t._v(" "),t._m(79),t._v(" "),t._m(80),t._v(" "),t._m(81),t._v(" "),t._m(82),t._v(" "),t._m(83),t._m(84),t._v(" "),t._m(85),t._v(" "),t._m(86),t._v(" "),t._m(87),t._v(" "),t._m(88),t._m(89),a("p",[t._v("通过这样，我们可以把 config 中的值直接注入到业务逻辑中。")]),t._v(" "),t._m(90),t._v(" "),a("p",[t._v("在原有逻辑中，日志对象也都挂载在 app.loggers 中，通过在 config 中配置的 key 来生成不同的日志实例对象，比如插件的日志，链路的日志等。")]),t._v(" "),t._m(91),t._v(" "),t._m(92),t._m(93),t._v(" "),t._m(94),t._m(95),t._v(" "),a("p",[t._v("midway 在新版本中默认对所有对象开启了请求作用域，处于该作用域下的对象，都会包含一个默认的日志对象。")]),t._v(" "),t._m(96),t._v(" "),t._m(97),t._m(98),t._v(" "),a("p",[t._v("除了标准的属性注入方法之外，midway 在一定程度上支持了构造器注入的方式，来让一些应用或者三方包平稳过度。")]),t._v(" "),t._m(99),t._v(" "),t._m(100),t._m(101),t._v(" "),t._m(102),t._v(" "),a("p",[t._v("在某些情况下，我们需要一个实例在被其他依赖调用前需要初始化，如果这个初始化只是读取某个文件，那么可以写成同步方式，而如果这个初始化是从远端拿取数据或者连接某个服务，这个情况下，普通的同步代码就非常的难写。")]),t._v(" "),t._m(103),t._v(" "),t._m(104),t._v(" "),t._m(105),t._m(106),t._v(" "),t._m(107),t._v(" "),a("p",[t._v("在某些场景下，我们需要函数作为某个逻辑动态执行，而 IoC 中的对象属性则都是已经创建好的，无法满足动态的逻辑需求。")]),t._v(" "),a("p",[t._v("比如你需要一个工厂函数，根据不同的场景返回不同的实例，也可能有一个三方包，是个函数，在业务中想要直接调用，种种的场景下，你就需要直接注入一个函数，并且在函数中拿到上下文。")]),t._v(" "),a("p",[t._v("标准的函数注入样例。")]),t._v(" "),t._m(108),a("p",[t._v("使用端。")]),t._v(" "),t._m(109),t._m(110),t._v(" "),a("p",[t._v("函数注入大多数为了创建一个简单的工厂。")]),t._v(" "),t._m(111),a("p",[t._v("这样在业务中，可以直接来使用了。")]),t._v(" "),t._m(112),t._m(113),t._v(" "),a("p",[t._v("经过大量的实践，我们沉淀出了一套标准的测试工具集。")]),t._v(" "),a("ul",[a("li",[t._v("测试工具包 "),a("a",{attrs:{href:"https://www.npmjs.com/package/midway-bin",target:"_blank",rel:"noopener noreferrer"}},[t._v("midway-bin"),a("OutboundLink")],1)]),t._v(" "),a("li",[t._v("测试框架 mocha")]),t._v(" "),a("li",[t._v("测试断言库 assert/chai")]),t._v(" "),a("li",[t._v("测试模拟 "),a("a",{attrs:{href:"https://www.npmjs.com/package/midway-mock",target:"_blank",rel:"noopener noreferrer"}},[t._v("midway-mock"),a("OutboundLink")],1)])]),t._v(" "),t._m(114),t._v(" "),t._m(115),t._v(" "),t._m(116),t._v(" "),a("p",[t._v("一个应用的测试目录示例：")]),t._v(" "),t._m(117),t._m(118),t._v(" "),a("p",[t._v("在脚手架中，我们已经将常见的命令进行内置，可能略微有些不同，大致代码如下。")]),t._v(" "),t._m(119),t._m(120),t._v(" "),t._m(121),t._m(122),t._v(" "),a("p",[t._v("在测试运行之前，我们首先要创建应用的一个 app 实例， 通过它来访问需要被测试的 Controller、Middleware、Service 等应用层代码。")]),t._v(" "),t._m(123),t._v(" "),t._m(124),a("p",[t._v("这样我们就拿到了一个 app 的引用，接下来所有测试用例都会基于这个 app 进行。 更多关于创建 app 的信息请查看 "),a("a",{attrs:{href:"https://github.com/eggjs/egg-mock#options",target:"_blank",rel:"noopener noreferrer"}},[t._v("mm.app(options)"),a("OutboundLink")],1),t._v(" 文档。")]),t._v(" "),t._m(125),t._v(" "),t._m(126)])},[function(){var t=this.$createElement,s=this._self._c||t;return s("div",{staticClass:"warning custom-block"},[s("p",{staticClass:"custom-block-title"},[this._v("注意")]),this._v(" "),s("p",[this._v("本文档还未完成，midway 还处于 beta 状态")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h1",{attrs:{id:"midway-开发指南"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#midway-开发指南","aria-hidden":"true"}},[this._v("#")]),this._v(" Midway 开发指南")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"介绍"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#介绍","aria-hidden":"true"}},[this._v("#")]),this._v(" 介绍")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("如今，集团内外的 Node.js 大环境早已脱离原有的前后端分离体系，朝着全栈的方向大步迈进，有着欣喜，有着期待，对此，MidwayJs 团队不仅仅承担着引导，支撑集团 Node.js 应用的责任，也同时通过 "),s("code",[this._v("Pandora.js")]),this._v(" ，"),s("code",[this._v("Sandbox")]),this._v("  等不同形式来让应用变的更加稳定，可靠。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"关于-midway"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#关于-midway","aria-hidden":"true"}},[this._v("#")]),this._v(" 关于 Midway")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"快速上手"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#快速上手","aria-hidden":"true"}},[this._v("#")]),this._v(" 快速上手")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"安装-node-环境"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#安装-node-环境","aria-hidden":"true"}},[this._v("#")]),this._v(" 安装 Node 环境")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"创建新应用"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#创建新应用","aria-hidden":"true"}},[this._v("#")]),this._v(" 创建新应用")])},function(){var t=this.$createElement,s=this._self._c||t;return s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[this._v("$ "),s("span",{attrs:{class:"token function"}},[this._v("npm")]),this._v(" i midway-init -g\n$ midway-init\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("通过生成的 "),s("code",[this._v("npm scripts")]),this._v(" 来驱动启动命令:")])},function(){var t=this.$createElement,s=this._self._c||t;return s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[this._v("$ "),s("span",{attrs:{class:"token function"}},[this._v("npm")]),this._v(" "),s("span",{attrs:{class:"token function"}},[this._v("install")]),this._v("\n$ "),s("span",{attrs:{class:"token function"}},[this._v("npm")]),this._v(" run dev\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"了解目录结构"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#了解目录结构","aria-hidden":"true"}},[this._v("#")]),this._v(" 了解目录结构")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ul",[a("li",[t._v("ts 源码存放于 "),a("code",[t._v("/src")]),t._v(" 目录下，编译后代码存放于 "),a("code",[t._v("/dist")]),t._v(" 下")]),t._v(" "),a("li",[t._v("以往的 app 等都迁移至 "),a("code",[t._v("/src/app")]),t._v(" 下，作为 web 层")]),t._v(" "),a("li",[t._v("传统的业务逻辑等，移动到其他目录，比如 "),a("code",[t._v("lib/service")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("div",{staticClass:"language-plain extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[this._v("➜  midway6-test tree -I node_modules\n.\n├── README.md\n├── README.zh-CN.md\n├── dist                                ---- 编译后目录\n├── logs                                ---- 本地日志目录\n│   └── midway6-test                    ---- 日志应用名开头\n│       ├── common-error.log            ---- 错误日志\n│       ├── midway-agent.log            ---- agent 输出的日志\n│       ├── midway-core.log             ---- 框架输出的日志\n│       ├── midway-web.log              ---- koa 输出的日志\n│       └── midway6-test-web.log\n├── package.json\n├── src                                 ---- 源码目录\n│   ├── app                             ---- web 层目录\n│   │   ├── controller                  ---- web 层 controller 目录\n│   │   │   ├── home.ts\n│   │   │   └── user.ts\n│   │   ├── middleware (可选)            ---- web 层中间件目录\n│   │   │   └── trace.ts\n│   │   ├── public (可选)                ---- web 层静态文件目录，可以配置\n│   │   ├── view (可选)\n│   │   |   └── home.tpl                ---- web 层模板\n│   ├── config\n│   │   ├── config.default.ts\n│   │   ├── config.local.ts\n│   │   ├── config.prod.ts\n│   │   ├── config.unittest.ts\n│   │   └── plugin.ts\n│   └── lib                             ---- 业务逻辑层目录\n│   │   ├── interface.ts                ---- 接口定义文件\n│   │   └── service                     ---- 业务逻辑层，目录根据业务自己定义\n│   │       └── user.ts   \n│   ├── app.ts                          ---- 应用扩展文件，可选\n│   └── agent.ts                        ---- agent 扩展文件，可选\n├── test\n│   └── app\n│       └── controller\n│           └── home.test.ts\n├── tsconfig.json\n└── tslint.json\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("li",[s("code",[this._v("app/controller/**")]),this._v(" 用于解析用户的输入，处理后返回相应的结果，具体参见 "),s("a",{attrs:{href:"hController"}},[this._v("Controller")]),this._v("。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"基础"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#基础","aria-hidden":"true"}},[this._v("#")]),this._v(" 基础")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"ioc-概览"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ioc-概览","aria-hidden":"true"}},[this._v("#")]),this._v(" IoC 概览")])},function(){var t=this.$createElement,s=this._self._c||t;return s("ul",[s("li",[this._v("什么是控制反转？")]),this._v(" "),s("li",[this._v("什么是依赖注入？")]),this._v(" "),s("li",[this._v("它们之间有什么关系？")])])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-ts extra-class"},[a("pre",{pre:!0,attrs:{class:"language-ts"}},[a("code",[a("span",{attrs:{class:"token comment"}},[t._v("// 常见的依赖")]),t._v("\n"),a("span",{attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{attrs:{class:"token constant"}},[t._v("A")]),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v("'./A'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{attrs:{class:"token constant"}},[t._v("B")]),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v("'./B'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),a("span",{attrs:{class:"token class-name"}},[t._v("C")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{attrs:{class:"token function"}},[t._v("consturctor")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{attrs:{class:"token keyword"}},[t._v("this")]),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("a "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{attrs:{class:"token class-name"}},[t._v("A")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{attrs:{class:"token keyword"}},[t._v("this")]),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("b "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{attrs:{class:"token class-name"}},[t._v("B")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("a"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-ts extra-class"},[a("pre",{pre:!0,attrs:{class:"language-ts"}},[a("code",[a("span",{attrs:{class:"token comment"}},[t._v("// 使用 IoC")]),t._v("\n"),a("span",{attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("Container"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v("'injection'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),a("span",{attrs:{class:"token comment"}},[t._v("// injection 是 midway 依赖的一个包")]),t._v("\n"),a("span",{attrs:{class:"token keyword"}},[t._v("const")]),t._v(" container "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{attrs:{class:"token class-name"}},[t._v("Container")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\ncontainer"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("bind")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token constant"}},[t._v("A")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\ncontainer"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("bind")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token constant"}},[t._v("B")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),a("span",{attrs:{class:"token class-name"}},[t._v("C")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{attrs:{class:"token function"}},[t._v("consturctor")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{attrs:{class:"token keyword"}},[t._v("this")]),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("a "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" container"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token keyword"}},[t._v("get")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token string"}},[t._v("'A'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{attrs:{class:"token keyword"}},[t._v("this")]),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("b "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" container"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token keyword"}},[t._v("get")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token string"}},[t._v("'B'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("这里的 "),s("code",[this._v("container")]),this._v("  就是 IoC 容器，是依赖注入这种设计模式的一种实现，使得 C 和 A, B 没有了强耦合关系，甚至，我们可以把 C 也交给 IoC 容器，所以，IoC 容器成了整个系统的关键核心。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("div",{staticClass:"tip custom-block"},[s("p",{staticClass:"custom-block-title"},[this._v("注意")]),this._v(" "),s("p",[this._v("IoC 容器就像是一个对象池，管理这每个对象实例的信息（Class Definition），所以用户无需关心什么时候创建，当用户希望拿到对象的实例 (Object Instance) 时，可以直接拿到实例，容器会 "),s("strong",[this._v("自动将所有依赖的对象都自动实例化")]),this._v("。")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"使用装饰器"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#使用装饰器","aria-hidden":"true"}},[this._v("#")]),this._v(" 使用装饰器")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("在我们长期的实践中，得出了应用往往被分为 "),s("code",[this._v("web")]),this._v(" 层以及 "),s("code",[this._v("service")]),this._v(" 层的结论。而在以往的设计中，midway 已经通过 "),s("code",[this._v("getPlugin")]),this._v(" 这类静态方法尽量避免不同层相互耦合和依赖，但是还是无法完全解决这个问题。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("在 Midway 6 的设计中，我们引入了 IoC 的概念，通过 ts 的高级语法糖，可以比较容易的将不同代码进行分层，解耦，这样，即使增加了 "),s("code",[this._v("manager")]),this._v(" 这些层，也能够进行方便的解耦。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("Midway 6 基于 ts，参考了业界的 IoC 实现，完成了属于自己的依赖注入能力，主要是通过 "),s("code",[this._v("@provide")]),this._v(" 和 "),s("code",[this._v("@inject")]),this._v(" 两个装饰器来完成。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("div",{staticClass:"tip custom-block"},[s("p",{staticClass:"custom-block-title"},[this._v("TIP")]),this._v(" "),s("p",[this._v("由于使用了依赖注入体系，我们希望所有的业务代码都通过 class 语法来完成")])])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-typescript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-typescript"}},[a("code",[t._v("@"),a("span",{attrs:{class:"token function"}},[t._v("provide")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),a("span",{attrs:{class:"token class-name"}},[t._v("UserService")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n \n  @"),a("span",{attrs:{class:"token function"}},[t._v("inject")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  userModel"),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n  "),a("span",{attrs:{class:"token keyword"}},[t._v("async")]),t._v(" "),a("span",{attrs:{class:"token function"}},[t._v("getUser")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("userId"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("await")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("this")]),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("userModel"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token keyword"}},[t._v("get")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("userId"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("ul",[s("li",[this._v("类加了装饰器，同时直接导出，不需要关心如何实例化")]),this._v(" "),s("li",[this._v("属性加了装饰器，但是没有任何初始化以及复制的操作即可使用")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h4",{attrs:{id:"provide"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#provide","aria-hidden":"true"}},[this._v("#")]),this._v(" @provide()")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("有了 "),s("code",[this._v("@provide()")]),this._v(" 装饰器，就可以被 IoC 容器自动扫描，并绑定定义到容器上，对应的逻辑是 "),s("a",{attrs:{href:"#%E6%89%8B%E5%8A%A8%E7%BB%91%E5%AE%9A%E5%AF%B9%E8%B1%A1"}},[this._v("手动绑定对象")]),this._v("。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("在 midway 中，默认扫描的目录为 "),s("code",[this._v("/src/app")]),this._v(" 和 "),s("code",[this._v("/src/lib")]),this._v("，在这两个目录中（包括子目录），都会被自动扫描以及加载。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[s("code",[this._v("@provide(id?)")]),this._v(" 的参数为对象 id，可选。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("div",{staticClass:"tip custom-block"},[s("p",{staticClass:"custom-block-title"},[this._v("注意")]),this._v(" "),s("p",[this._v("@provide 装饰器是用于自动被 IoC 容器装载。")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h4",{attrs:{id:"inject"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#inject","aria-hidden":"true"}},[this._v("#")]),this._v(" @inject()")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[s("code",[this._v("@inject()")]),this._v(" 的作用是将容器中的定义实例化成一个对象，并且绑定到属性中，这样，在调用的时候就可以访问到该属性。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("div",{staticClass:"warning custom-block"},[s("p",{staticClass:"custom-block-title"},[this._v("注意")]),this._v(" "),s("p",[this._v("注入的时机为构造器（new）之后，所以在构造方法(constructor)中是无法获取注入的属性的，如果要获取注入的内容，可以使用 "),s("a",{attrs:{href:"#%E6%9E%84%E9%80%A0%E5%99%A8%E6%B3%A8%E5%85%A5"}},[this._v("构造器注入")]),this._v("。")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"对象-id"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#对象-id","aria-hidden":"true"}},[this._v("#")]),this._v(" 对象 id")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("在默认情况下，Midway 会将类名变为 "),s("code",[this._v("驼峰")]),this._v(" 形式作为对象 id，这样你可以通过容器获取实例。")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-typescript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-typescript"}},[a("code",[t._v("container"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("getAsync")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token string"}},[t._v("'userService'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),a("span",{attrs:{class:"token comment"}},[t._v("// 根据字符串 id 获取实例")]),t._v("\ncontainer"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("getAsync")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("UserService"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("   "),a("span",{attrs:{class:"token comment"}},[t._v("// 传入类名，自动根据类目获取实例")]),t._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("默认情况下，Midway 的依赖注入使用的是 "),s("code",[this._v("byName")]),this._v(" ，只要同名，就会自动进行注入。")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-typescript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-typescript"}},[a("code",[t._v("@"),a("span",{attrs:{class:"token function"}},[t._v("provide")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token string"}},[t._v("'uModel'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),a("span",{attrs:{class:"token class-name"}},[t._v("UserModel")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n@"),a("span",{attrs:{class:"token function"}},[t._v("provide")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token string"}},[t._v("'user'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),a("span",{attrs:{class:"token class-name"}},[t._v("UserService")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n \n  @"),a("span",{attrs:{class:"token function"}},[t._v("inject")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token string"}},[t._v("'uModel'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  userModel"),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n  "),a("span",{attrs:{class:"token keyword"}},[t._v("async")]),t._v(" "),a("span",{attrs:{class:"token function"}},[t._v("getUser")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("userId"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("await")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("this")]),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("userModel"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token keyword"}},[t._v("get")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("userId"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),a("span",{attrs:{class:"token comment"}},[t._v("// 使用修改之后的 id 获取对象")]),t._v("\n"),a("span",{attrs:{class:"token keyword"}},[t._v("const")]),t._v(" userService "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("await")]),t._v(" applicationContext"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("getAsync")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token string"}},[t._v("'user'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("同理，在使用 "),s("code",[this._v("@inject")]),this._v(" 的时候也可以使用不同的 id。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"路由和控制器"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#路由和控制器","aria-hidden":"true"}},[this._v("#")]),this._v(" 路由和控制器")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"使用装饰器-2"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#使用装饰器-2","aria-hidden":"true"}},[this._v("#")]),this._v(" 使用装饰器")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("在新的 ts 体系中，我们的控制器目录为 "),s("code",[this._v("app/controller")]),this._v(" ，我们在其中编写 "),s("code",[this._v("*.ts")]),this._v(" 文件。例如下面的 "),s("code",[this._v("userController.ts")]),this._v(" ，我们提供了一个获取用户的接口。")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-typescript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-typescript"}},[a("code",[t._v("@"),a("span",{attrs:{class:"token function"}},[t._v("provide")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n@"),a("span",{attrs:{class:"token function"}},[t._v("controller")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token string"}},[t._v("'/user'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),a("span",{attrs:{class:"token class-name"}},[t._v("UserController")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\n  @"),a("span",{attrs:{class:"token function"}},[t._v("inject")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token string"}},[t._v("'userService'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  service"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" IUserService"),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n  @"),a("span",{attrs:{class:"token keyword"}},[t._v("get")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token string"}},[t._v("'/:id'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),a("span",{attrs:{class:"token keyword"}},[t._v("async")]),t._v(" "),a("span",{attrs:{class:"token function"}},[t._v("getUser")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ctx"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Promise"),a("span",{attrs:{class:"token operator"}},[t._v("<")]),a("span",{attrs:{class:"token keyword"}},[t._v("void")]),a("span",{attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{attrs:{class:"token keyword"}},[t._v("const")]),t._v(" id"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token builtin"}},[t._v("number")]),t._v(" "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" ctx"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("params"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("id"),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{attrs:{class:"token keyword"}},[t._v("const")]),t._v(" user"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" IUserResult "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("await")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("this")]),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("service"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("getUser")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("id"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    ctx"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("body "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("success"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token boolean"}},[t._v("true")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" message"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v("'OK'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" data"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" user"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("我们创建了 "),s("code",[this._v("@controller")]),this._v(" 装饰器用来定义这个类为 Controller，同时，提供了方法装饰器用于标注请求的类型。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("div",{staticClass:"tip custom-block"},[s("p",{staticClass:"custom-block-title"},[this._v("小贴士")]),this._v(" "),s("p",[this._v("便于大家理解，"),s("code",[this._v("@controller")]),this._v(" 的参数为字符串 pattern，我们会将这个值传入 "),s("code",[this._v("router.prefix(prefix)")]),this._v(" 的参数中。")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("blockquote",[s("p",[this._v("注意，由于类加载是由文件扫描的顺序来保证的，有着不确定性，请不要在这里做路由顺序匹配的事情。")])])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ul",[a("li",[t._v("@get")]),t._v(" "),a("li",[t._v("@post")]),t._v(" "),a("li",[t._v("@del")]),t._v(" "),a("li",[t._v("@put")]),t._v(" "),a("li",[t._v("@patch")]),t._v(" "),a("li",[t._v("@options")]),t._v(" "),a("li",[t._v("@head")]),t._v(" "),a("li",[t._v("@all")])])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-typescript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-typescript"}},[a("code",[t._v("@"),a("span",{attrs:{class:"token keyword"}},[t._v("get")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token string"}},[t._v("'/:id'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{attrs:{class:"token keyword"}},[t._v("async")]),t._v(" "),a("span",{attrs:{class:"token function"}},[t._v("getUser")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ctx"),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" next"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Promise"),a("span",{attrs:{class:"token operator"}},[t._v("<")]),a("span",{attrs:{class:"token keyword"}},[t._v("void")]),a("span",{attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{attrs:{class:"token comment"}},[t._v("// TODO ctx...")]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"路由绑定"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#路由绑定","aria-hidden":"true"}},[this._v("#")]),this._v(" 路由绑定")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("在以往框架的写法中，提供的 "),s("code",[this._v("app/router")]),this._v(" 文件，虽然可以直接使用，但是由于控制器被 IoC 管控的关系，会有一些区别。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("和以往的写法不同的是，"),s("strong",[this._v("我们需要从容器中拿到对应的控制器实例，并绑定到路由的 pattern 上")]),this._v("。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("假如我们有一个控制器，同时没有提供 "),s("code",[this._v("@controller")]),this._v(" 装饰器，表明他不是一个控制器，在应用初始化时不会自动绑定到某个路由上，但是由于有 "),s("code",[this._v("@provide")]),this._v(" 装饰器，他会被 IoC 容器所加载。")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-typescript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-typescript"}},[a("code",[a("span",{attrs:{class:"token comment"}},[t._v("// app/controller/api.ts")]),t._v("\n\n@"),a("span",{attrs:{class:"token function"}},[t._v("provide")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),a("span",{attrs:{class:"token class-name"}},[t._v("BaseApi")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{attrs:{class:"token keyword"}},[t._v("async")]),t._v(" "),a("span",{attrs:{class:"token function"}},[t._v("index")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ctx"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    ctx"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("body "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v("'index'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n")])])])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-typescript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-typescript"}},[a("code",[a("span",{attrs:{class:"token comment"}},[t._v("// app/router.ts")]),t._v("\n\n"),a("span",{attrs:{class:"token keyword"}},[t._v("module")]),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function-variable function"}},[t._v("exports")]),t._v(" "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("function")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("app"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  app"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token keyword"}},[t._v("get")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token string"}},[t._v("'/api/index'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" app"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("generateController")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token string"}},[t._v("'baseApi.index'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("midway 扩展了一个 "),s("code",[this._v("app.generateController")]),this._v(" 的方法来简化绑定的这个步骤，参数为 "),s("code",[this._v("ClassName.methodName")]),this._v(" 的字符串形式。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"路由优先级"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#路由优先级","aria-hidden":"true"}},[this._v("#")]),this._v(" 路由优先级")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("在单页应用下，经常会出现 "),s("code",[this._v("/*")]),this._v(" 这种路由，在原本的路由文件中，我们可以通过调整代码的顺序，来使的路由的匹配顺序发生变化。而由于使用了装饰器的关系，在新题的体系无法控制文件扫描和加载顺序，这就使得路由匹配的顺序不可控。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("midway 提供了 "),s("code",[this._v("@priority(priority: number)")]),this._v(" 装饰器，用于修饰 class，定义路由的优先级，默认的路由优先级为 "),s("code",[this._v("0")]),this._v("，可以设置负数让优先级降低。")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-ts extra-class"},[a("pre",{pre:!0,attrs:{class:"language-ts"}},[a("code",[t._v("@"),a("span",{attrs:{class:"token function"}},[t._v("provide")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n@"),a("span",{attrs:{class:"token function"}},[t._v("priority")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token operator"}},[t._v("-")]),a("span",{attrs:{class:"token number"}},[t._v("1")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n@"),a("span",{attrs:{class:"token function"}},[t._v("controller")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token string"}},[t._v("'/'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),a("span",{attrs:{class:"token class-name"}},[t._v("HomeController")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\n  @"),a("span",{attrs:{class:"token keyword"}},[t._v("get")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token string"}},[t._v("'/hello'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),a("span",{attrs:{class:"token keyword"}},[t._v("async")]),t._v(" "),a("span",{attrs:{class:"token function"}},[t._v("index")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ctx"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    ctx"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("body "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v("'hello'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n  @"),a("span",{attrs:{class:"token keyword"}},[t._v("get")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token string"}},[t._v("'/*'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),a("span",{attrs:{class:"token keyword"}},[t._v("async")]),t._v(" "),a("span",{attrs:{class:"token function"}},[t._v("all")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ctx"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    ctx"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("body "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v("'world'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"增强的依赖注入"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#增强的依赖注入","aria-hidden":"true"}},[this._v("#")]),this._v(" 增强的依赖注入")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"获取-ioc-容器"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#获取-ioc-容器","aria-hidden":"true"}},[this._v("#")]),this._v(" 获取 IoC 容器")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("所谓的容器就是一个对象池，它会在应用初始化的时候自动处理类的依赖，并将类进行实例化。比如上边的 "),s("code",[this._v("UserService")]),this._v(" 类，在经过容器初始化之后，会自动实例化，并且对 "),s("code",[this._v("userModel")]),this._v(" 进行赋值。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("Midway 内部使用了自动扫描的机制，在应用初始化之前，会扫描所有的文件，包含装饰器的文件会 "),s("strong",[this._v("自动绑定")]),this._v(" 到容器。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("div",{staticClass:"tip custom-block"},[s("p",{staticClass:"custom-block-title"},[this._v("注意")]),this._v(" "),s("p",[this._v("midway 中默认为请求作用域，指的是在一次请求过程中，对象的实例保持不变，可以通过 @scope 装饰器来修改，参考 "),s("a",{attrs:{href:"#%E9%85%8D%E7%BD%AE%E4%BD%9C%E7%94%A8%E5%9F%9F"}},[this._v("配置作用域")]),this._v("。")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("在大部分情况下，用于的业务逻辑和请求相关，我们将 IoC 容器绑定到了 "),s("code",[this._v("KOA Context")]),this._v(" 中，即 "),s("code",[this._v("ctx.requestContext")]),this._v(" ，在任意能拿到 ctx 的地方，都可以通过 "),s("code",[this._v("getAsync()")]),this._v(" 方法获取对象。")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-ts extra-class"},[a("pre",{pre:!0,attrs:{class:"language-ts"}},[a("code",[a("span",{attrs:{class:"token comment"}},[t._v("// 在 midway 中使用 IoC")]),t._v("\n"),a("span",{attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{attrs:{class:"token constant"}},[t._v("A")]),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v("'./A'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{attrs:{class:"token constant"}},[t._v("B")]),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v("'./B'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n@"),a("span",{attrs:{class:"token function"}},[t._v("provide")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),a("span",{attrs:{class:"token class-name"}},[t._v("C")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\n  @"),a("span",{attrs:{class:"token function"}},[t._v("inject")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token string"}},[t._v("'A'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  a"),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  \n  @"),a("span",{attrs:{class:"token function"}},[t._v("inject")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token string"}},[t._v("'B'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  b"),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-typescript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-typescript"}},[a("code",[t._v("app"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("getApplicationContext")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nmidway"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("getApplicationContext")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"手动绑定对象"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#手动绑定对象","aria-hidden":"true"}},[this._v("#")]),this._v(" 手动绑定对象")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-typescript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-typescript"}},[a("code",[a("span",{attrs:{class:"token comment"}},[t._v("// 内部代码")]),t._v("\n"),a("span",{attrs:{class:"token keyword"}},[t._v("const")]),t._v(" container "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{attrs:{class:"token class-name"}},[t._v("Container")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\ncontainer"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("bind")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("UserModel"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\ncontainer"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("bind")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("UserService"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{attrs:{class:"token comment"}},[t._v("//... 省略逻辑")]),t._v("\n\n"),a("span",{attrs:{class:"token keyword"}},[t._v("const")]),t._v(" userService "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("await")]),t._v(" container"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("getAsync")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("UserService"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{attrs:{class:"token keyword"}},[t._v("const")]),t._v(" user "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("await")]),t._v(" userService"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("getUser")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token string"}},[t._v("'123'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{attrs:{class:"token comment"}},[t._v("//...")]),t._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"配置作用域"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#配置作用域","aria-hidden":"true"}},[this._v("#")]),this._v(" 配置作用域")])},function(){var t=this.$createElement,s=this._self._c||t;return s("ul",[s("li",[this._v("Singleton 单例，全局唯一（进程级别）")]),this._v(" "),s("li",[this._v("Request  "),s("strong",[this._v("默认")]),this._v("，请求作用域，生命周期随着请求链路，在请求链路上唯一，请求结束立即销毁")]),this._v(" "),s("li",[this._v("Prototype 原型作用域，每次调用都会重复创建一个新的对象")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("在这三种作用域中，midway 的默认作用域为 "),s("strong",[this._v("请求作用域")]),this._v("，这也意味着，如果我们需要将一个对象定义为其他两种作用域，需要额外的配置。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("midway 提供了 "),s("code",[this._v("@scope")]),this._v(" 装饰器来定义一个类的作用域。")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-typescript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-typescript"}},[a("code",[t._v("@"),a("span",{attrs:{class:"token function"}},[t._v("scope")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ScopeEnum"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Prototype"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n@"),a("span",{attrs:{class:"token function"}},[t._v("provide")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token string"}},[t._v("'petrol'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),a("span",{attrs:{class:"token class-name"}},[t._v("PetrolEngine")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("implements")]),t._v(" "),a("span",{attrs:{class:"token class-name"}},[t._v("Engine")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  capacity "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token number"}},[t._v("10")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n@"),a("span",{attrs:{class:"token function"}},[t._v("scope")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ScopeEnum"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Singleton"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n@"),a("span",{attrs:{class:"token function"}},[t._v("provide")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token string"}},[t._v("'diesel'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),a("span",{attrs:{class:"token class-name"}},[t._v("DieselEngine")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("implements")]),t._v(" "),a("span",{attrs:{class:"token class-name"}},[t._v("Engine")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  capacity "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token number"}},[t._v("20")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n\n"),a("span",{attrs:{class:"token comment"}},[t._v("// in IoC Container")]),t._v("\n"),a("span",{attrs:{class:"token function"}},[t._v("assert")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("container"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("getAsync")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token string"}},[t._v("'petrol'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token operator"}},[t._v("===")]),t._v(" container"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("getAsync")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token string"}},[t._v("'petrol'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("  "),a("span",{attrs:{class:"token comment"}},[t._v("// false")]),t._v("\n"),a("span",{attrs:{class:"token function"}},[t._v("assert")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("container"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("getAsync")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token string"}},[t._v("'diesel'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token operator"}},[t._v("===")]),t._v(" container"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("getAsync")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token string"}},[t._v("'diesel'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("  "),a("span",{attrs:{class:"token comment"}},[t._v("// true")]),t._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"框架增强注入"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#框架增强注入","aria-hidden":"true"}},[this._v("#")]),this._v(" 框架增强注入")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h4",{attrs:{id:"注入插件"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#注入插件","aria-hidden":"true"}},[this._v("#")]),this._v(" 注入插件")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("midway 可以使用 egg 和 midway 两者的插件，以往，我们通过 "),s("code",[this._v("midway.getPlugin")]),this._v(" 或者 "),s("code",[this._v("app.xxx")]),this._v(" 的方式来获取插件，而在新的情况下，我们可以通过 "),s("code",[this._v("@plugin")]),this._v(" 装饰器来注入插件。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("比如我们提供了一个名字叫 "),s("code",[this._v("plugin2")]),this._v(" 的插件，就可以通过属性注入的方式来修饰插件。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("blockquote",[s("p",[this._v("注意，由于在 midway 内部插件未放在 applicationContext 中，所以不能使用 @inject 来注入")])])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-typescript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-typescript"}},[a("code",[t._v("@"),a("span",{attrs:{class:"token function"}},[t._v("provide")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),a("span",{attrs:{class:"token class-name"}},[t._v("BaseService")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\n  @"),a("span",{attrs:{class:"token function"}},[t._v("plugin")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token string"}},[t._v("'plugin2'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  plugin"),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("这个时候我们就需要拿到插件的名字，我们会不断增加插件的 key 列表，请查看 "),s("a",{attrs:{href:"plugin_key"}},[this._v("插件key")]),this._v("。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h4",{attrs:{id:"注入配置"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#注入配置","aria-hidden":"true"}},[this._v("#")]),this._v(" 注入配置")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("在 midway 中不同环境的 config 都会挂载到 app.config 中，但是不是所有的业务逻辑都会依赖 app 对象，所以我们构造了 "),s("code",[this._v("@config")]),this._v(" 装饰器来获取配置对象。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("假如 "),s("code",[this._v("config.default.ts")]),this._v(" 中有一些代码。")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-typescript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-typescript"}},[a("code",[a("span",{attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("const")]),t._v(" hello "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token number"}},[t._v("1")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-typescript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-typescript"}},[a("code",[t._v("@"),a("span",{attrs:{class:"token function"}},[t._v("provide")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),a("span",{attrs:{class:"token class-name"}},[t._v("BaseService")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\n  @"),a("span",{attrs:{class:"token function"}},[t._v("config")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token string"}},[t._v("'hello'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  config"),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("   "),a("span",{attrs:{class:"token comment"}},[t._v("// 1")]),t._v("\n\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h4",{attrs:{id:"注入日志对象"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#注入日志对象","aria-hidden":"true"}},[this._v("#")]),this._v(" 注入日志对象")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("比如自定义一个日志，这个时候，日志的 key 则为 "),s("code",[this._v("customLogger")]),this._v(" 。")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-typescript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-typescript"}},[a("code",[a("span",{attrs:{class:"token keyword"}},[t._v("module")]),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function-variable function"}},[t._v("exports")]),t._v(" "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" appInfo "),a("span",{attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    customLogger"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      xxLogger"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        file"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" path"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("join")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("appInfo"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("root"),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v("'logs/xx.log'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("这个时候可以用 "),s("code",[this._v("@logger")]),this._v(" 来获取日志实例。")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-typescript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-typescript"}},[a("code",[t._v("@"),a("span",{attrs:{class:"token function"}},[t._v("provide")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),a("span",{attrs:{class:"token class-name"}},[t._v("BaseService")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\n  @"),a("span",{attrs:{class:"token function"}},[t._v("logger")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token string"}},[t._v("'customLogger'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  logger"),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h4",{attrs:{id:"请求作用域中的日志"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#请求作用域中的日志","aria-hidden":"true"}},[this._v("#")]),this._v(" 请求作用域中的日志")])},function(){var t=this.$createElement,s=this._self._c||t;return s("blockquote",[s("p",[this._v("该 logger 对象是在请求链路开始就埋入到 IoC 容器中，所以可以通过 @inject 可以获取该对象，  key 就为 logger，如果和属性同名则可以不填。")])])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-typescript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-typescript"}},[a("code",[t._v("@"),a("span",{attrs:{class:"token function"}},[t._v("provide")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),a("span",{attrs:{class:"token class-name"}},[t._v("BaseService")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\n  @"),a("span",{attrs:{class:"token function"}},[t._v("inject")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  logger"),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n  "),a("span",{attrs:{class:"token comment"}},[t._v("// 也可以直接传入 key")]),t._v("\n  "),a("span",{attrs:{class:"token comment"}},[t._v("// @inject('logger')")]),t._v("\n  "),a("span",{attrs:{class:"token comment"}},[t._v("// logger;")]),t._v("\n  \n\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"构造器注入"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#构造器注入","aria-hidden":"true"}},[this._v("#")]),this._v(" 构造器注入")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("同样还是使用 "),s("code",[this._v("@inject")]),this._v(" 装饰器。")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-typescript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-typescript"}},[a("code",[t._v("@"),a("span",{attrs:{class:"token function"}},[t._v("provide")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),a("span",{attrs:{class:"token class-name"}},[t._v("A")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  config "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    c"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token number"}},[t._v("20")]),t._v("\n  "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n\n@"),a("span",{attrs:{class:"token function"}},[t._v("provide")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),a("span",{attrs:{class:"token class-name"}},[t._v("B")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  config "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    c"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token number"}},[t._v("40")]),t._v("\n  "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n@"),a("span",{attrs:{class:"token function"}},[t._v("provide")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),a("span",{attrs:{class:"token class-name"}},[t._v("BaseService")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\n  config"),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  plugin2"),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n  "),a("span",{attrs:{class:"token keyword"}},[t._v("constructor")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n    @"),a("span",{attrs:{class:"token function"}},[t._v("inject")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" a"),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    @"),a("span",{attrs:{class:"token function"}},[t._v("config")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token string"}},[t._v("'hello'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" config"),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    @"),a("span",{attrs:{class:"token function"}},[t._v("inject")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" b"),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    @"),a("span",{attrs:{class:"token function"}},[t._v("plugin")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token string"}},[t._v("'plugin2'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" plugin2\n  "),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{attrs:{class:"token keyword"}},[t._v("this")]),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("config "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" Object"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("assign")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("config"),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      c"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" a"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("config"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("c "),a("span",{attrs:{class:"token operator"}},[t._v("+")]),t._v(" b"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("config"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("c "),a("span",{attrs:{class:"token operator"}},[t._v("+")]),t._v(" config"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("c\n    "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{attrs:{class:"token keyword"}},[t._v("this")]),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("plugin2 "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" plugin2"),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" \n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("在一个类的构造器中，我们可以还可以使用其他的类似 "),s("code",[this._v("@config")]),this._v(" "),s("code",[this._v("@plugin")]),this._v(" "),s("code",[this._v("@logger")]),this._v(" 等装饰器。只要是通过 IoC 管理的对象，都能够被自动依赖和注入。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"异步初始化"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#异步初始化","aria-hidden":"true"}},[this._v("#")]),this._v(" 异步初始化")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("midway 提供了异步初始化的能力，通过 "),s("code",[this._v("@async")]),this._v("  和  "),s("code",[this._v("@init")]),this._v(" 标签来管理初始化方法。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[s("code",[this._v("@init")]),this._v(" 方法目前只能是一个。")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-typescript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-typescript"}},[a("code",[t._v("@"),a("span",{attrs:{class:"token keyword"}},[t._v("async")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n@"),a("span",{attrs:{class:"token function"}},[t._v("provide")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),a("span",{attrs:{class:"token class-name"}},[t._v("BaseService")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\n  @"),a("span",{attrs:{class:"token function"}},[t._v("config")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token string"}},[t._v("'hello'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  config"),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n  @"),a("span",{attrs:{class:"token function"}},[t._v("plugin")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token string"}},[t._v("'plugin2'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  plugin2"),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n  @"),a("span",{attrs:{class:"token function"}},[t._v("init")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),a("span",{attrs:{class:"token keyword"}},[t._v("async")]),t._v(" "),a("span",{attrs:{class:"token function"}},[t._v("init")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{attrs:{class:"token keyword"}},[t._v("await")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{attrs:{class:"token class-name"}},[t._v("Promise")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("resolve "),a("span",{attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),a("span",{attrs:{class:"token function"}},[t._v("setTimeout")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{attrs:{class:"token keyword"}},[t._v("this")]),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("config"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("c "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token number"}},[t._v("10")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),a("span",{attrs:{class:"token function"}},[t._v("resolve")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{attrs:{class:"token number"}},[t._v("100")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("只要在类上标记 "),s("code",[this._v("@async")]),this._v(" 装饰器之后，就代表了这个类会有异步初始化的情况，这个时候会自动通过异步的情况来调用 "),s("code",[this._v("@init")]),this._v("  标记的方法。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"动态函数注入"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#动态函数注入","aria-hidden":"true"}},[this._v("#")]),this._v(" 动态函数注入")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-typescript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-typescript"}},[a("code",[a("span",{attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{attrs:{class:"token function"}},[t._v("contextHandler")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("context"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("async")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{attrs:{class:"token comment"}},[t._v("// const xxx = context.getAsync('xxxx');")]),t._v("\n    "),a("span",{attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{attrs:{class:"token boolean"}},[t._v("true")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),a("span",{attrs:{class:"token function"}},[t._v("providerWrapper")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n  "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    id"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v("'contextHandler'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    provider"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" contextHandler"),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-typescript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-typescript"}},[a("code",[t._v("@"),a("span",{attrs:{class:"token function"}},[t._v("provide")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),a("span",{attrs:{class:"token class-name"}},[t._v("BaseService")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\n  @"),a("span",{attrs:{class:"token function"}},[t._v("inject")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  contextHandler"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{attrs:{class:"token builtin"}},[t._v("boolean")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("midway 通过 "),s("code",[this._v("providerWrapper")]),this._v(" 函数来包裹一个函数，并且指定提供的 key，供其他 IoC 对象使用。由于函数直接传递了一个 context 对象，可以轻松的通过此对象拿到所需的其他对象，而不需要管理依赖。")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-typescript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-typescript"}},[a("code",[a("span",{attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{attrs:{class:"token function"}},[t._v("adapterFactory")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("context"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" IApplicationContext"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("async")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("adapterName"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token builtin"}},[t._v("string")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("adapterName "),a("span",{attrs:{class:"token operator"}},[t._v("===")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v("'google'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),a("span",{attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("await")]),t._v(" context"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("getAsync")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token string"}},[t._v("'googleAdapter'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    "),a("span",{attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("adapterName "),a("span",{attrs:{class:"token operator"}},[t._v("===")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v("'baidu'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),a("span",{attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("await")]),t._v(" context"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("getAsync")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token string"}},[t._v("'baiduAdapter'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    "),a("span",{attrs:{class:"token comment"}},[t._v("// return await context.getAsync(adapterName + 'Adapter');")]),t._v("\n  "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),a("span",{attrs:{class:"token function"}},[t._v("providerWrapper")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n  "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    id"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v("'adapterFactory'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    provider"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" adapterFactory"),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-typescript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-typescript"}},[a("code",[t._v("\n@"),a("span",{attrs:{class:"token keyword"}},[t._v("async")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n@"),a("span",{attrs:{class:"token function"}},[t._v("provide")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),a("span",{attrs:{class:"token class-name"}},[t._v("BaseService")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\n  @"),a("span",{attrs:{class:"token function"}},[t._v("config")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token string"}},[t._v("'adapterName'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  adapterName"),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n  @"),a("span",{attrs:{class:"token function"}},[t._v("inject")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token string"}},[t._v("'adapterFactory'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  factory"),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n  adapter"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Adapter"),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n  @"),a("span",{attrs:{class:"token function"}},[t._v("init")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),a("span",{attrs:{class:"token keyword"}},[t._v("async")]),t._v(" "),a("span",{attrs:{class:"token function"}},[t._v("init")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{attrs:{class:"token keyword"}},[t._v("this")]),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("adapter "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("await")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("this")]),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("factory")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token keyword"}},[t._v("this")]),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("adapterName"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"应用测试"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#应用测试","aria-hidden":"true"}},[this._v("#")]),this._v(" 应用测试")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"测试目录结构"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#测试目录结构","aria-hidden":"true"}},[this._v("#")]),this._v(" 测试目录结构")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("我们约定 "),s("code",[this._v("test")]),this._v(" 目录为存放所有测试脚本的目录，测试所使用到的 "),s("code",[this._v("fixtures")]),this._v(" 和相关辅助脚本都应该放在此目录下。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("测试脚本文件统一按 "),s("code",[this._v("${filename}.test.ts")]),this._v(" 命名，必须以 "),s("code",[this._v(".test.ts")]),this._v(" 作为文件后缀。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("div",{staticClass:"language-plain extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[this._v("test\n├── controller\n│   └── home.test.ts\n├── hello.test.ts\n└── service\n    └── user.test.ts\n\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"测试命令"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#测试命令","aria-hidden":"true"}},[this._v("#")]),this._v(" 测试命令")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-json extra-class"},[a("pre",{pre:!0,attrs:{class:"language-json"}},[a("code",[a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{attrs:{class:"token property"}},[t._v('"scripts"')]),a("span",{attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{attrs:{class:"token property"}},[t._v('"test"')]),a("span",{attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v('"midway-bin test --ts"')]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{attrs:{class:"token property"}},[t._v('"cov"')]),a("span",{attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v('"midway-bin cov --ts"')]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[s("span",{staticStyle:{color:"rgb(88, 88, 88)"},attrs:{"data-type":"color"}},[s("span",{staticStyle:{"background-color":"rgb(255, 255, 255)"},attrs:{"data-type":"background"}},[this._v("然后就可以按标准的 ")])]),s("code",[this._v("npm test")]),s("span",{staticStyle:{color:"rgb(88, 88, 88)"},attrs:{"data-type":"color"}},[s("span",{staticStyle:{"background-color":"rgb(255, 255, 255)"},attrs:{"data-type":"background"}})]),this._v("来运行测试了。")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{attrs:{class:"token function"}},[t._v("npm")]),t._v(" "),a("span",{attrs:{class:"token function"}},[t._v("test")]),t._v("\n\n"),a("span",{attrs:{class:"token operator"}},[t._v(">")]),t._v(" unittest-example@ "),a("span",{attrs:{class:"token function"}},[t._v("test")]),t._v(" /Users/harry/midwayj/examples/unittest\n"),a("span",{attrs:{class:"token operator"}},[t._v(">")]),t._v(" midway-bin "),a("span",{attrs:{class:"token function"}},[t._v("test")]),t._v(" --ts\n\n  test/hello.test.ts\n    ✓ should work\n\n  1 passing "),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("10ms"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"测试完整应用"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#测试完整应用","aria-hidden":"true"}},[this._v("#")]),this._v(" 测试完整应用")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("通过 "),s("code",[this._v("midway-mock")]),this._v("，结合 Mocha 的 "),s("code",[this._v("before")]),this._v(" 钩子就可以便捷地创建出一个 app 实例。")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-typescript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-typescript"}},[a("code",[a("span",{attrs:{class:"token comment"}},[t._v("// test/controller/home.test.js")]),t._v("\n"),a("span",{attrs:{class:"token keyword"}},[t._v("const")]),t._v(" assert "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("require")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token string"}},[t._v("'assert'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" mm "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v("'midway-mock'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{attrs:{class:"token function"}},[t._v("describe")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token string"}},[t._v("'test/controller/home.test.ts'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{attrs:{class:"token keyword"}},[t._v("let")]),t._v(" app"),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{attrs:{class:"token function"}},[t._v("before")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{attrs:{class:"token comment"}},[t._v("// 创建当前应用的 app 实例")]),t._v("\n    app "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" mm"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("app")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{attrs:{class:"token comment"}},[t._v("// 等待 app 启动成功，才能执行测试用例")]),t._v("\n    "),a("span",{attrs:{class:"token keyword"}},[t._v("return")]),t._v(" app"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("ready")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("每一个测试文件都需要这样创建一个 app 实例非常冗余，因此 "),s("code",[this._v("midway-mock")]),this._v(" 提供了一个 bootstrap 文件，可以直接从它上面拿到我们所常用的实例：")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-typescript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-typescript"}},[a("code",[a("span",{attrs:{class:"token comment"}},[t._v("// test/controller/home.test.ts")]),t._v("\n"),a("span",{attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" app"),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" mock"),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" assert "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("require")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token string"}},[t._v("'midway-mock/bootstrap'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{attrs:{class:"token function"}},[t._v("describe")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token string"}},[t._v("'test/controller/home.test.ts'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{attrs:{class:"token comment"}},[t._v("// test cases")]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n")])])])}],!1,null,null,null);e.options.__file="guide.md";s.default=e.exports}}]);